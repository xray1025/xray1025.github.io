<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="X_ray">


    <meta name="subtitle" content="yesterday you said tomorrow">




<title>Redis | X_ray&#39;s blog</title>



    <link rel="icon" href="/image/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.1.1"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Xray&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Xray&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Redis</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">X_ray</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">九月 2, 2020&nbsp;&nbsp;16:33:01</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Java/">Java</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><blockquote>
<p>NoSQL = Not Only SQL</p>
</blockquote>
<p>关系型数据库：表格</p>
<p>非关系型数据库：格式不固定，易于横向扩展</p>
<a id="more"></a>

<blockquote>
<p>传统数据库</p>
<ul>
<li>结构化组织</li>
<li>SQL</li>
<li>数据和关系存在单独的表中</li>
<li>数据定义语言</li>
<li>严格的一致性</li>
<li>基础的事务</li>
<li>。。。</li>
</ul>
</blockquote>
<blockquote>
<p>NoSQL</p>
<ul>
<li>不仅仅是数据</li>
<li>没有固定的查询语言</li>
<li>键值对存储、列存储、文档存储、图形数据库</li>
<li>最终一致性</li>
<li>CAP/BASE</li>
<li>高性能、高可用、高拓展</li>
<li>。。。</li>
</ul>
</blockquote>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>Redis（remote dictionary server）远程字典服务</p>
</blockquote>
<blockquote>
<ul>
<li>C</li>
<li>支持网络</li>
<li>内存持久化</li>
<li>kv键值对</li>
<li>主从同步</li>
</ul>
</blockquote>
<ul>
<li>数据库</li>
<li>缓存</li>
<li>中间件</li>
</ul>
<h1 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h1><p>redis-benchmark</p>
<ul>
<li>-c指定并发连接数</li>
<li>-n指定请求数</li>
</ul>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><ul>
<li><p>默认16个数据库</p>
</li>
<li><p>默认使用第0个 </p>
<ul>
<li><p>select 0</p>
</li>
<li><p>dbsize</p>
</li>
<li><p>keys *</p>
</li>
<li><p>清空当前数据库：flushdb</p>
</li>
<li><p>清空所有：flushall</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>redis是单线程的</p>
<ul>
<li>redis是基于内存操作的</li>
<li>对内存来说，没有多线程的上下文切换效率更高</li>
<li>redis的性能瓶颈不是cpu，而是机器内存和网络宽带</li>
<li>6.0 后是多线程的</li>
</ul>
</blockquote>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h2><ul>
<li><p>setex()：设置过期时间（set with exprie）</p>
</li>
<li><p>setnx()：不存在则设置（set if not exist）</p>
</li>
<li><p>set user{name:alice, age:11}</p>
</li>
<li><p>mget/mset</p>
</li>
<li><p>getset</p>
</li>
</ul>
<h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h2><ul>
<li>所有命令L开头：LPUSH/LRANGE</li>
<li>RPUSH/RPOP</li>
</ul>
<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><ul>
<li>不能重复</li>
<li>所有命令S开头</li>
</ul>
<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><ul>
<li>h开头</li>
</ul>
<h2 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h2><ul>
<li>在set的基础上增加了一个值</li>
<li>zset k1 score1 v1</li>
<li>以score排序</li>
</ul>
<h2 id="geospatial"><a href="#geospatial" class="headerlink" title="geospatial"></a>geospatial</h2><ul>
<li>geoadd/geodist/geohash/geopos/georadious/georadiousbymember</li>
</ul>
<h2 id="hyperloglog"><a href="#hyperloglog" class="headerlink" title="hyperloglog"></a>hyperloglog</h2><ul>
<li><p>基数：不重复的元素，可以接受误差</p>
</li>
<li><p>网页UV：一个人访问网页多次仍算一次访问</p>
</li>
</ul>
<h2 id="bitmap"><a href="#bitmap" class="headerlink" title="bitmap"></a>bitmap</h2><ul>
<li>位运算</li>
<li>统计用户信息 0、1</li>
</ul>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><ul>
<li><p>一组命令的集合</p>
</li>
<li><p>单条命令保证原子性</p>
</li>
<li><p>事务不保证原子性</p>
</li>
<li><p>没有隔离级别的概念</p>
</li>
<li><p>步骤：</p>
<ul>
<li>开启事务（）：multi</li>
<li>命令入队（）：</li>
<li>执行事务（）：exec</li>
</ul>
</li>
<li><p>编译时异常，所有命令都不执行</p>
</li>
<li><p>运行时异常，其他命令继续执行</p>
</li>
</ul>
<h1 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h1><ul>
<li><p>悲观锁：所有行为都加锁</p>
</li>
<li><p>乐观锁：所有行为都不加锁，更新数据的时候获取版本判断数据是否被tar修改</p>
</li>
<li><p>redis实现：</p>
<ul>
<li>使用watch监视</li>
<li>如果执行失败，unwatch解锁</li>
<li>重新监视</li>
</ul>
</li>
</ul>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><ul>
<li>redis官方推荐的java连接工具</li>
</ul>
<h1 id="SpringBoot整合"><a href="#SpringBoot整合" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h1><ul>
<li><p>在springboot2.x之后，jedis被替换为了lettuce</p>
</li>
<li><p>jedis：直连，多线程不安全，需要使用jedis pool连接池 BIO</p>
</li>
<li><p>lettuce：netty，多线程共享，可以减少线程数量 NIO</p>
</li>
<li><p>自定义redisTemplate</p>
</li>
</ul>
<h1 id="conf详解"><a href="#conf详解" class="headerlink" title="conf详解"></a>conf详解</h1><ul>
<li><p>unit单位大小写不敏感</p>
</li>
<li><p>包含其他配置文件</p>
</li>
<li><p>网络：</p>
<ul>
<li>bind 127.0.0.1</li>
<li>protected-mode yes</li>
<li>port 6379</li>
</ul>
</li>
<li><p>daemoize yes # 以守护进程的方式运行，默认为no</p>
</li>
<li><p>pidfile /var/run/redis_6379.pid # 制定一个pid文件后台运行</p>
</li>
<li><p>loglevel notice # 日志</p>
</li>
<li><p>datebase 16</p>
</li>
<li><p>snapshot</p>
<ul>
<li>执行多少次操作则持久化到文件.rdb.aof</li>
<li>save 900 1 900s内，至少1个key修改则持久化</li>
<li>save 300 10 300s内，至少10个key修改则持久化</li>
<li>save 60 100 60s内，至少100个key修改则持久化</li>
</ul>
</li>
<li><p>stop-writes-on-bgsave-error 持久化出错是否继续工作</p>
</li>
<li><p>rdbcompression 是否压缩rdb文件</p>
</li>
<li><p>rdbchecksum 保存rdb文件是否进行校验</p>
</li>
<li><p>dir./ rdb文件保存目录</p>
</li>
<li><p>REPLICATION 复制</p>
</li>
<li><p>SECURITY 安全 密码默认为空</p>
</li>
<li><p>maxclients</p>
</li>
<li><p>maxmemory</p>
</li>
<li><p>maxmemory-policy noeviction内存满时的处理策略</p>
</li>
<li><p>append only # aof配置</p>
<ul>
<li>appendonly no 默认关闭，使用rdb持久化</li>
<li>appendfilename</li>
<li>appendfsync always/everysec/no</li>
</ul>
</li>
</ul>
<h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><ul>
<li>内存型数据库</li>
</ul>
<h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><p>redis database</p>
<ul>
<li>在指定的时间间隔内将内存中的数据集快照写入硬盘</li>
<li>单独创建一个子进程，先将数据写入临时文件，等待持久化过程结束，再用这个临时文件替换上次持久化好的文件</li>
<li>主进程不进行任何IO操作</li>
<li>适合大规模的数据恢复</li>
<li>最后一次持久化的数据肯丢失</li>
<li>默认RDB</li>
<li>dump.rdb</li>
</ul>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><p>append only file</p>
<ul>
<li><p>将所有命令都记录下来（读操作不记录）</p>
</li>
<li><p>恢复时把文件重新构建</p>
</li>
<li><p>不适合大规模数据恢复</p>
</li>
<li><p>redis-check-aof –fix 修复AOF</p>
</li>
<li><p>aof文件大于64M则新建AOF</p>
</li>
</ul>
<h1 id="订阅"><a href="#订阅" class="headerlink" title="订阅"></a>订阅</h1><ul>
<li>发送消息：PUBLISH XXX</li>
<li>接收信息：SUBSCRIBE XXX</li>
</ul>
<h1 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h1><ul>
<li>数据的复制是单向的</li>
<li>读写分离</li>
<li>作用<ul>
<li>数据冗余</li>
<li>故障恢复</li>
<li>负载均衡</li>
<li>高可用</li>
</ul>
</li>
<li>info replication：查看复制信息</li>
<li>修改port、pid、log、dump.rdb</li>
</ul>
<h1 id="哨兵（sentinel）"><a href="#哨兵（sentinel）" class="headerlink" title="哨兵（sentinel）"></a>哨兵（sentinel）</h1><ul>
<li><p>主机故障时，从机根据投票自动变为主机</p>
</li>
<li><p>主观下线：一个哨兵发现主机不可用</p>
</li>
<li><p>客观下线：多个哨兵发现主机不可用，哨兵对从机进行投票切换主机</p>
</li>
<li><p>步骤：</p>
<ul>
<li>配置哨兵：sentinel monitor myredis 127.0.0.1 6379 1</li>
<li>启动哨兵：redis-sentinel </li>
</ul>
</li>
<li><p>主机重新上线后变为从机</p>
</li>
<li><p>优点</p>
<ul>
<li>基于主从复制</li>
<li>主从可以切换，可用性高</li>
<li>手动到自动，健壮性好</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>难以在线扩容</li>
<li>实现哨兵的配置麻烦</li>
</ul>
</li>
</ul>
<h1 id="缓存穿透和雪崩、击穿"><a href="#缓存穿透和雪崩、击穿" class="headerlink" title="缓存穿透和雪崩、击穿"></a>缓存穿透和雪崩、击穿</h1><h2 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h2><ul>
<li>大量用户查询的数据在redis内存数据库中没有，继而大量访问持久层数据库<ul>
<li>布隆过滤器：对多有可能查询的参数以hash形式存储，在控制层进行校验，不符合则丢弃，从而减小了对底层存储系统的压力</li>
<li>缓存空对象：</li>
</ul>
</li>
</ul>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><ul>
<li>大量请求并发地对一个热点数据进行访问，当这个数据失效的书剑，持续的大并发就穿透缓存，直接访问数据库<ul>
<li>设置热点永不过期</li>
<li>加互斥锁</li>
</ul>
</li>
</ul>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><ul>
<li>在一个时间段，缓存集中过期失效，redis宕机<ul>
<li>redis高可用</li>
<li>限量降级</li>
<li>数据预热</li>
</ul>
</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>X_ray</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://xray1025.github.io/2020/09/02/redis/">https://xray1025.github.io/2020/09/02/redis/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>yesterday you said tomorrow</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Redis/"># Redis</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/09/02/JVM/">JVM</a>
            
            
            <a class="next" rel="next" href="/2020/09/02/MySQL/">MySQL</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© X_ray | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
